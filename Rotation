#include <Wire.h>
#include "Adafruit_Sensor.h"
#include "Adafruit_BNO055.h"
#include "utility/imumaths.h"
#include "Servo.h"

Adafruit_BNO055 bno = Adafruit_BNO055(55);
sensors_event_t event;
Servo MyServo;  
Servo MyServo2; 
int LeftLED = 13;
int RightLED = 12;

void setup(void) 
{  

  Serial.begin(9600);
  Serial.println("Orientation Sensor Test"); Serial.println("");
  MyServo.attach(9);
  MyServo2.attach(6);
  pinMode(LeftLED, OUTPUT);
  /* Initialise the sensor */
  if(!bno.begin())
  {
    /* There was a problem detecting the BNO055 ... check your connections */
    Serial.print("Ooops, no BNO055 detected ... Check your wiring or I2C ADDR!");
    while(1);
  }
  
  delay(1000);
    
  bno.setExtCrystalUse(true);

}
 
void loop(void) 
{
    /* Get a new sensor event */ 
 
  bno.getEvent(&event);
  double positions[4] = {180, 90, 270, 0};
  double times[4] = {1.0, 0.75, 0.50, 0.25};
  for(int i = 0; i < 3; i++)
    {
        rotate(positions[i]);
        MyServo.write(90);
        MyServo2.write(90);
        delay(1000); 
        digitalWrite(LeftLED,LOW);
        digitalWrite(RightLED,LOW);     
    }
}

void rotate(int p) {

    bno.getEvent(&event);
    int x = event.orientation.x;
    int left = p - 15;
    int right = p + 15;
    int cw = 60;
    int ccw = 120;
    while (x < left || x > right)
    {
       bno.getEvent(&event);
       x = event.orientation.x;
         Serial.print("X: ");
         Serial.print(event.orientation.x, 4);
         Serial.print("\n");
         delay(100);
        switch (p) {
            case 180:
                // clockwise and LED
                digitalWrite(LeftLED,HIGH);
                digitalWrite(RightLED,LOW);
                MyServo.write(cw);
                MyServo2.write(cw);
                break;
            case 90:
                // counterclockwise and 
                digitalWrite(LeftLED,LOW);
                digitalWrite(RightLED,HIGH);
                MyServo.write(ccw);
                MyServo2.write(ccw);
                break;
            case 270:
                // counterclockwise and LED
                digitalWrite(LeftLED,LOW);
                digitalWrite(RightLED,HIGH);
                MyServo.write(ccw);
                MyServo2.write(ccw);
                break;
            case 0:
                // clockwise and LED
                digitalWrite(LeftLED,HIGH);
                digitalWrite(RightLED,LOW);
                MyServo.write(cw);
                MyServo2.write(cw);
                break;
        }
    }
}// end hold()
